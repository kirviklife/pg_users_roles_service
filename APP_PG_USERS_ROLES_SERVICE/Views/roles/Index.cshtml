@model IEnumerable<APP_PG_USERS_ROLES_SERVICE.Models.roles>

@{
	ViewData["Title"] = "Index";
}


<div class="row g-3 mb-4 align-items-center justify-content-between">
	<div class="col-auto">
		<div class="page-utilities">
			<div class="row g-2 justify-content-start justify-content-md-end align-items-center">
				<div class="col-auto">
					<h1 class="app-page-title mb-0">Роли и пользователи системы</h1>

				</div>
			</div><!--//row-->
		</div><!--//table-utilities-->
	</div><!--//col-auto-->
</div><!--//row-->

<div class="row gy-4">
	<div class="col-12 col-lg-12">
		<div class="app-card app-card-account shadow-sm d-flex flex-column align-items-start">
			<div class="app-card-header p-3 border-bottom-0">
				<div class="row align-items-center gx-3">
					<div class="col-auto">
						<div class="app-icon-holder">
							<svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" fill="currentColor" class="bi bi-people" viewBox="0 0 16 16">
								<path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8Zm-7.978-1A.261.261 0 0 1 7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002a.274.274 0 0 1-.014.002H7.022ZM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816ZM4.92 10A5.493 5.493 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0Zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z" />
							</svg>
						</div><!--//icon-holder-->

					</div><!--//col-->
					<div class="col-auto">
						<h4 class="app-card-title">Пользователи</h4>
					</div><!--//col-->
					<div class="col-auto">
						@Html.TextBox("SearchUser","",new { @class="form-control", placeholder="Поиск по пользователям..."})
					</div><!--//col-->
				</div><!--//row-->
			</div><!--//app-card-header-->
			<div class="app-card-body px-4 w-100">

				<div class="item border-bottom py-3" style="min-height: 200px;max-height: 200px; overflow-y:auto;-webkit-overflow-scrolling: touch;">
					<table class="table">
						<thead>
							<tr>
								<th>
									Логин
								</th>
								<th>
									ФИО
								</th>
								<th>
									Почта
								</th>
								<th>
									Телефон
								</th>
								<th>
									Подключение
								</th>
								<th>
									Суперпользователь
								</th>
								<th>
									Создавать БД
								</th>
								<th>
									Создавать роли
								</th>
								<th>
									Наследование прав ролей
								</th>
								<th>
									Для репликаций
								</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							@foreach (var item in Model)
							{
								if (item.is_login || item.fam != null)
								{
									<tr>
										<td>
											@Html.DisplayFor(modelItem => item.role_name)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.fam) @Html.DisplayFor(modelItem => item.im) @Html.DisplayFor(modelItem => item.otch)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.email)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.phone)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_login)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_superuser)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_createdb)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_createrole)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_inherit)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_replication)
										</td>
										<td>
											@if (item.role_name != "postgres")
											{
												<a asp-action="EditUser" asp-controller="Roles" asp-route-id="@item.id_role" style="color: darkorange">
													<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-pen" viewBox="0 0 16 16">
														<path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001zm-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708l-1.585-1.585z" />
													</svg>
												</a>
												<a asp-action="DeleteUser"  asp-controller="Roles" asp-route-id="@item.id_role" style="color: red">
													<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-x-octagon" viewBox="0 0 16 16">
														<path d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353L4.54.146zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1H5.1z" />
														<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
													</svg>
												</a>
											}
										</td>
									</tr>
								}
								
							}
						</tbody>
					</table>


				</div><!--//item-->
			</div><!--//app-card-body-->
			<div class="app-card-footer p-4 mt-auto">
				
					<input type="submit" value="Обновить данные с сервера" id="btnupdusr" data-toggle="modal" data-target="#myModal" class="btn app-btn-secondary" />
					<button type="button" data-toggle="ajax-modal" data-target="#AddRole" class="BtnModalView btn app-btn-secondary" data-url="@Url.Action("CreateUser","Roles", new { srvid = ViewBag.ID_Srv})">Добавить пользователя</button>

			</div><!--//app-card-footer-->

		</div><!--//app-card-->
	</div><!--//col-->
	<div class="col-12 col-lg-12">
		<div class="app-card app-card-account shadow-sm d-flex flex-column align-items-start">
			<div class="app-card-header p-3 border-bottom-0">
				<div class="row align-items-center gx-3">
					<div class="col-auto">
						<div class="app-icon-holder">
							<svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" fill="currentColor" class="bi bi-person-gear" viewBox="0 0 16 16">
								<path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm.256 7a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256Zm3.63-4.54c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382l.045-.148ZM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z" />
							</svg>
						</div><!--//icon-holder-->

					</div><!--//col-->
					<div class="col-auto">
						<h4 class="app-card-title">Роли</h4>
					</div><!--//col-->
					<div class="col-auto">
						@Html.TextBox("SearchRole","",new { @class="form-control", placeholder="Поиск по ролям..."})
					</div><!--//col-->
				</div><!--//row-->
			</div><!--//app-card-header-->
			<div class="app-card-body px-4 w-100">
				<div class="item border-bottom py-3" style="max-height: 200px; overflow-y:auto;-webkit-overflow-scrolling: touch;">
					<table class="table">
						<thead>
							<tr>
								<th>
									Имя роли
								</th>
								<th>
									Подключение
								</th>
								<th>
									Суперпользователь
								</th>
								<th>
									Создавать БД
								</th>
								<th>
									Создавать роли
								</th>
								<th>
									Наследование прав ролей
								</th>
								<th>
									Для репликаций
								</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							@foreach (var item in Model)
							{
								if (!item.is_login && item.fam == null)
								{
									<tr>
										<td>
											@Html.DisplayFor(modelItem => item.role_name)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_login)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_superuser)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_createdb)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_createrole)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_inherit)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.is_replication)
										</td>
										<td>
											@if (item.role_name != "postgres")
											{
												<a asp-action="EditUser" asp-controller="Roles" asp-route-id="@item.id_role" style="color: darkorange">
													<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-pen" viewBox="0 0 16 16">
														<path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001zm-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708l-1.585-1.585z" />
													</svg>
												</a>
												<a asp-action="DeleteUser" asp-controller="Roles" asp-route-id="@item.id_role" style="color: red">
													<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-x-octagon" viewBox="0 0 16 16">
														<path d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353L4.54.146zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1H5.1z" />
														<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
													</svg>
												</a>
											}
										</td>
									</tr>
								}

							}
						</tbody>
					</table>
				</div><!--//item-->
			</div><!--//app-card-body-->
			<div class="app-card-footer p-4 mt-auto">

				<input type="submit" value="Обновить данные с сервера" id="btnupdusr" data-toggle="modal" data-target="#myModal" class="btn app-btn-secondary" />
				<button type="button" data-toggle="ajax-modal" data-target="#AddRole" class="BtnModalView btn app-btn-secondary" data-url="@Url.Action("CreateUser","Roles", new { srvid = ViewBag.ID_Srv})">Добавить роль</button>

			</div><!--//app-card-footer-->

		</div><!--//app-card-->
	</div><!--//col-->
</div><!--//row-->


<div id="PlaceHolderHere">
</div>